import{r as l,W as j,a as f,j as s,F as k,b as e,d as I,c as Y,g as H}from"./app-b5400095.js";import{U as O,e as T,w as q,d as A,L as F,M as U,D as W,f as G}from"./Dashboard-7e829a24.js";import{S as J}from"./search-bf68dfd3.js";import{B as K}from"./Breadcrumb-861bfeaa.js";import{E as P}from"./EditIcon-e59255f2.js";import{I as L}from"./index.es-78cf8708.js";import{C as Q}from"./CheckOutline-2d7627b9.js";import{d as R}from"./debounce-367be966.js";import{f as V}from"./index-3f3950c2.js";import"./index-4c8a935a.js";const X=h=>{const{auth:M,chat:x,model:c,chat_bot:m}=h,[u,d]=l.useState(!0),[C,b]=l.useState([]),[$,y]=l.useState(null),[E,g]=l.useState(!1),{data:v,setData:w,reset:N}=j({message:"",bot_id:m.id,chat_id:x.id,prompt:m.prompt,model:c}),D=async t=>{if(t.preventDefault(),g(!0),v.message.length>0){const o={role:"user",message:v.message};b(_=>[..._,o]),N("message");const n=await f.post("/ai-chats",v);n.data.error?(T(n.data.error),g(!1)):n.data.warning?(q(n.data.warning),g(!1)):(b(_=>[..._,n.data]),g(!1))}};l.useEffect(()=>{(async()=>{const t=await f.get(`/ai-chats/bot/messages/${m.id}/${x.id}`);b(o=>[...o,...t.data.data]),y(t.data),t.data.current_page>=t.data.last_page?d(!1):d(!0)})()},[]);const S=async t=>{const o=await f.get(t.next_page_url);b(n=>[...o.data.data,...n]),y(o.data),o.data.current_page>=o.data.last_page?d(!1):d(!0)};return s(k,{children:[e("div",{id:"scrollableDiv",className:"flex flex-col-reverse overflow-auto h-[calc(100vh-420px)] md:h-[calc(100vh-454px)]",children:e(L,{inverse:!0,hasMore:u,dataLength:C.length,next:()=>S($),scrollableTarget:"scrollableDiv",style:{display:"flex",flexDirection:"column-reverse"},loader:e("p",{className:"text-center",children:"Loading..."}),endMessage:e("p",{className:"text-center",children:"Yay! You have seen it all"}),children:s("div",{className:"px-7 py-3.5 flex flex-col",children:[C.length>0&&C.map(t=>t.role==="user"?e("dib",{className:"w-full py-3.5 ",children:s("div",{className:"max-w-[80%] flex float-right",children:[e("p",{className:"p-5 text-sm bg-primary-25 text-gray-700 rounded-lg",children:t.message}),M.user.image?e("img",{src:`/${M.user.image}`,alt:"ai-bot",className:"w-9 h-9 ml-5 border border-white rounded-lg shadow-card"}):e(O,{className:"h-10 w-10 text-blue-gray-500 lg:m-1 cursor-pointer"})]})},t.id):s("div",{className:"py-3.5 max-w-[80%] flex",children:[e("img",{src:`/${m.image}`,alt:"ai-bot",className:"w-9 h-9 mr-5 border border-white rounded-lg shadow-card"}),e("div",{className:"w-full flex flex-col",children:e("pre",{className:"p-5 text-sm bg-primary-25 text-gray-700 rounded-lg whitespace-pre-wrap",children:t.message})})]},t.id)),E&&s("div",{className:"py-3.5 max-w-[80%] flex",children:[e("img",{src:`/${m.image}`,alt:"ai-bot",className:"w-9 h-9 mr-5 border border-white rounded-lg shadow-card"}),e("p",{className:"p-5 text-sm bg-primary-25 text-gray-700 rounded-lg",children:"Typing..."})]})]})})}),s("form",{onSubmit:D,className:"p-7 border-t border-gray-100 flex items-center",children:[e("input",{type:"text",value:v.message,onChange:t=>w("message",t.target.value),placeholder:"Enter a message here To send, press (shift + enter).",className:"w-full h-[38px] placeholder:text-gray-400 text-sm outline-0 pr-2"}),e(I.Button,{type:"submit",color:"white",className:"capitalize bg-primary-500 text-white text-sm !rounded px-7 py-2.5",children:"Send"})]})]})},Z=h=>{const{auth:M,active:x,chat_bot:c,global:m}=h,[u,d]=l.useState(h.chats.data),[C,b]=l.useState(h.chats),[$,y]=l.useState(null),[E,g]=l.useState(!1),[v,w]=l.useState(!0),[N,D]=l.useState({id:"",value:""}),[S,t]=l.useState(null),o=async()=>{const a={chat_bot_id:c.id,title:"New Conversation"},r=await f.post("/ai-chats/chat/create",a);d(i=>[r.data,...i]),y(r.data)};l.useEffect(()=>{if(x){const a=parseInt(x),r=u.find(i=>i.id===a);y(r)}else y(u[1])},[]);const n=async a=>{const{current_page:r,last_page:i}=a;if(r<i){const p=await f.get(`/ai-chats/chats?page=${r+1}&bot_id=${c.id}`);d(B=>[...B,...p.data.data]),b(p.data),p.data.current_page>=p.data.last_page?w(!1):w(!0)}else w(!1)},_=async a=>{if(a.preventDefault(),t(!1),N.value.length>0)try{const r=await f.put(`/ai-chats/chat/update/${N.id}`,N);if(r.data.success){const i=u.map(p=>r.data.result.id===p.id?r.data.result:p);d(i)}else r.data.error&&T(r.data.error)}catch(r){G(r.response.data.errors.value)}},z=R(async a=>{const r=a.target.value,i=await f.get(`/ai-chats/chat/search?value=${r}`);d(i.data),i.data.length<=0&&w(!1)},300);return s(k,{children:[e(Y,{title:"Dashboard"}),e(K,{Icon:A,title:c.name}),s(I.Card,{className:"shadow-card h-[calc(100vh-232px)] md:h-[calc(100vh-266px)] overflow-hidden flex-row justify-end relative",children:[e("div",{className:`absolute top-0 left-0 z-10 h-full w-0 lg:w-[246px] bg-white  border-r border-gray-100 overflow-hidden transition-all duration-300 ${E?"w-[246px] shadow-card":"w-0"}`,children:s("div",{className:"w-[246px]",children:[s("div",{className:"w-full p-7 relative border-b border-gray-100 flex items-center",children:[s("div",{className:"w-full md:max-w-[260px] relative",children:[e("input",{type:"text",placeholder:"Search",onChange:z,className:"h-9 pr-12 pl-4 py-[15px] placeholder:text-gray-400 border border-gray-100 focus:border-primary-500 focus:ring-0 focus:outline-0 rounded-md w-full text-sm font-normal text-gray-500 bg-gray-100"}),e(J,{className:"absolute w-4 h-4 top-2.5 right-3 text-gray-400 z-10"})]}),e("button",{className:"block lg:hidden absolute top-7 right-0 bg-gray-200 hover:bg-gray-200 active:bg-gray-200 w-5 h-9 text-gray-500 rounded-l-md",onClick:()=>g(!1),children:e(F,{})})]}),e("div",{id:"scrollableDiv",className:"flex flex-col h-[calc(100vh-420px)] md:h-[calc(100vh-454px)] overflow-auto",children:e(L,{inverse:!1,hasMore:v,dataLength:u.length,scrollableTarget:"scrollableDiv",next:()=>n(C),style:{display:"flex",flexDirection:"column"},loader:e("p",{className:"text-center",children:"Loading..."}),endMessage:e("p",{className:"text-center my-2",children:"Yay! You have seen it all"}),children:u.map(a=>s("div",{className:`relative p-5 ${x==a.id?"bg-gray-100 hover:bg-gray-200":"bg-gray-25 hover:bg-gray-100"}`,children:[s("div",{className:"cursor-pointer w-full",onClick:()=>S!==a.id&&H.get(`/ai-chats/bot/${c.id}?chat=${a.id}`),children:[S===a.id?s("form",{onSubmit:_,className:"relative rounded-md",children:[e("input",{required:!0,type:"text",placeholder:"Edit title",value:N.value,onChange:r=>D({id:a.id,value:r.target.value}),className:"h-8 pl-2.5 pr-12 py-[12px] placeholder:text-gray-400 outline outline-1 outline-gray-200 focus:outline-primary-500 focus:ring-0 rounded-md w-full text-sm font-normal text-gray-700",maxLength:20}),e("button",{type:"submit",className:"absolute top-0 right-0 w-8 h-full flex items-center justify-center bg-gray-200 rounded-r-md",children:e(Q,{className:" text-gray-400 z-10"})})]}):e("p",{className:"text-sm text-gray-700 font-medium",children:a.title}),e("p",{className:"text-sm text-gray-400",children:V(new Date(a.created_at),"dd-MM-yyyy ss:mm:hh a")})]}),e("div",{className:"absolute top-4 right-4 z-10 w-4 h-4 cursor-pointer",children:S!==a.id&&e(P,{onClick:()=>{D({id:a.id,value:a.title}),t(a.id)},className:"w-4 h-4 text-gray-400"})})]},a.id))})}),e("div",{className:"p-7",children:e(I.Button,{color:"white",onClick:o,className:"w-full capitalize bg-primary-500 text-white text-sm !rounded px-7 py-2.5",children:"New Conversation"})})]})}),s("div",{className:"w-full lg:w-[calc(100%-246px)]",children:[s("div",{className:"p-7 border-b border-gray-100 flex items-center",children:[e(I.IconButton,{variant:"text",color:"blue-gray",className:"block lg:hidden mr-4",onClick:()=>g(!0),children:e(U,{})}),e("img",{src:`/${c.image}`,alt:"ai-bot",className:"w-9 h-9 border border-white rounded-lg shadow-card"}),e("p",{className:"text-lg text-gray-900 font-bold ml-3",children:c.name})]}),$&&c&&e(X,{auth:M,chat:$,chat_bot:c,model:m.model})]})]})]})};Z.layout=h=>e(W,{children:h});export{Z as default};
